<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Swim Cut Checker</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f9fc;
      padding-top: 80px;
      color: #2c3e50;
    }
    #header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #fff;
      padding: 1rem;
      text-align: center;
      font-size: 2rem;
      color: #2c3e50;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .summary {
      text-align: center;
      margin: 2rem auto 0.5rem;
      font-weight: bold;
    }
    .summary h2 {
      font-size: 1.5rem;
      margin-bottom: 0.3rem;
      background-color: #d0eaff;
      padding: 0.3rem;
      border-radius: 5px;
    }
    .summary p {
      margin: 0.2rem 0;
    }
    .divider {
      border-top: 3px solid #ccc;
      width: 90%;
      margin: 3rem auto;
    }
    table {
      width: 90%;
      margin: 1rem auto;
      border-collapse: collapse;
    }
    th, td {
      border: 2px solid #888;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      background-color: #e9f5fb;
      font-weight: bold;
    }
    .scy-met, .lcm-met {
      background-color: #d0f0c0;
    }
    .scy-miss, .lcm-miss {
      background-color: #fbdcdc;
    }
    .achieved {
      color: green;
      font-weight: bold;
    }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      th, td {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div id="header"></div>
  <div id="content"></div>
  <script>
    const swimCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR517EAit_Mv_l2LJa7TbXINy5Eq-v9fa9kwF8QX0ZUk8GG2pRbtBjPzM4vN8X00w/pub?gid=1331787204&single=true&output=csv';
    const standardsCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS8azb2ync4URwqJmg9XiYUqVH9IMsHkbVYSf71e8lwIgrqOlB9ezp4HHYhDbG_gw/pub?gid=1081039398&single=true&output=csv';
    const eventOrder = ['50 Freestyle','100 Freestyle','200 Freestyle','500 Freestyle','100 Butterfly','200 Butterfly','100 Breastroke','200 Breastroke','100 Backstroke','200 Backstroke','200 IM'];
    async function fetchCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      const [headerLine, ...lines] = text.trim().split('\n');
      const headers = headerLine.split(',');
      return lines.map(line => {
        const values = line.split(',');
        return headers.reduce((obj, header, i) => {
          obj[header.trim()] = values[i]?.trim();
          return obj;
        }, {});
      });
    }
    function parseTime(str) {
      if (!str || str.toLowerCase() === 'dq') return null;
      const parts = str.split(':').map(parseFloat);
      return parts.reduce((acc, val) => acc * 60 + val);
    }
    function toTimeStr(seconds) {
      if (seconds == null) return '-';
      const min = Math.floor(seconds / 60);
      const sec = (seconds % 60).toFixed(2).padStart(5, '0');
      return min > 0 ? `${min}:${sec}` : `${sec}`;
    }
    async function loadData() {
      const swimData = await fetchCSV(swimCSV);
      const stdData = await fetchCSV(standardsCSV);
      const swimmer = swimData[0];
      const swimmerName = "Saanvi Khopkar";
      const birthdate = new Date(swimmer['swimmer_date_of_birth']);
      const age = new Date().getFullYear() - birthdate.getFullYear();
      document.getElementById('header').textContent = `${swimmerName}, Age ${age}`;

      const swimmerPB = { SCY: {}, LCM: {} };
      swimData.forEach(r => {
        const c = r.Course, e = r.Event, t = parseTime(r['Final Time']);
        if (!c || !e || !t) return;
        if (!swimmerPB[c][e] || parseTime(swimmerPB[c][e].time) > t) {
          swimmerPB[c][e] = { time: t, meet: r['meet_name'], date: r['event_date'] };
        }
      });

      const standards = { Regionals: { SCY: {}, LCM: {} }, State: { SCY: {}, LCM: {} } };
      stdData.forEach(r => {
        const s = r.Standards, c = r.Course, e = r.Event;
        const t = parseTime(r.Time);
        if (s && c && e && t) standards[s][c][e] = t;
      });

      ['Regionals', 'State'].forEach(level => {
        const summary = document.createElement('div');
        summary.className = 'summary';
        summary.innerHTML = `<h2>${level}</h2>`;

        ['SCY', 'LCM'].forEach(course => {
          let cuts = 0;
          const rows = eventOrder.map(event => {
            const std = standards[level][course][event];
            const pb = swimmerPB[course][event]?.time;
            const met = pb != null && std != null && pb <= std;
            if (met) cuts++;
            return {
              event,
              std,
              pb,
              diff: pb && std ? pb - std : null,
              met
            };
          });

          summary.innerHTML += `<p>${course}: ${cuts} cuts</p>`;
          const table = document.createElement('table');
          table.innerHTML = `<tr><th>${course} Standards</th><th>${course} PB</th><th><strong>Event</strong></th><th>${course === 'SCY' ? 'LCM PB' : 'SCY PB'}</th><th>${course === 'SCY' ? 'LCM Standards' : 'SCY Standards'}</th><th>Status</th></tr>` +
            rows.map(r => `<tr>
              <td class="${r.met ? course.toLowerCase()+'-met' : course.toLowerCase()+'-miss'}">${toTimeStr(r.std)}</td>
              <td class="${r.met ? course.toLowerCase()+'-met' : course.toLowerCase()+'-miss'}">${toTimeStr(r.pb)}</td>
              <td><strong>${r.event}</strong></td>
              <td>-</td>
              <td>-</td>
              <td>${r.met ? '<span class="achieved">Achieved</span>' : r.diff != null ? `${r.diff.toFixed(2)} sec away` : '-'}</td>
            </tr>`).join('');
          document.getElementById('content').appendChild(summary);
          document.getElementById('content').appendChild(table);
        });
        document.getElementById('content').appendChild(document.createElement('div')).className = 'divider';
      });
    }
    loadData();
  </script>
</body>
</html>
